{% extends "base.html" %}
{% set page_title = "Data Logger Setting" %}
{% block content %}
<div class="card border-0 shadow-soft mb-3">
  <div class="card-body d-flex flex-wrap gap-2 justify-content-between align-items-center">
    <div class="position-relative" style="min-width:280px;max-width:360px;width:100%;">
      <span class="position-absolute top-50 translate-middle-y ms-3 opacity-50">ðŸ”Ž</span>
      <input class="form-control ps-5" placeholder="Search data loggersâ€¦" oninput="App.filterTable('#tbl', this.value)">
    </div>
    <a class="btn btn-primary" href="{{ url_for('logger_settings_bp.datalogger_add') }}">+ Add Data Logger</a>
  </div>
</div>

<div class="card border-0 shadow-soft">
  <div class="table-responsive">
    <table id="tbl" class="table table-hover align-middle mb-0">
      <thead class="table-dark-subtle">
        <tr>
          <th>Active</th>
          <th>Name</th>
          <th>Interval</th>
          <th>Description</th>
          <th style="width:120px"></th>
        </tr>
      </thead>
      <tbody>
        {% for lg in items %}
        <tr>
          <td>{% if lg.enabled %}<span class="badge text-bg-success">True</span>{% else %}<span
              class="badge text-bg-secondary">False</span>{% endif %}</td>
          <td class="fw-semibold">{{ lg.name }}</td>
          <td>{{ lg.interval_sec }} s</td>
          <td class="text-muted">{{ lg.description or 'â€”' }}</td>
          <td class="text-end">
            <div class="btn-group">
              <a class="btn btn-sm btn-outline-secondary"
                href="{{ url_for('logger_settings_bp.datalogger_edit', lid=lg.id) }}">
                Edit
              </a>
              <form method="post" action="{{ url_for('logger_settings_bp.datalogger_delete', lid=lg.id) }}"
                class="d-inline" onsubmit="return confirm('Delete this data logger?')">
                <button class="btn btn-sm btn-outline-danger">Delete</button>
              </form>
            </div>
          </td>

        </tr>
        {% else %}
        <tr>
          <td colspan="5" class="text-center text-muted py-4">No data loggers yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<script>
window.App = window.App || {};
App.filterTable = function(tableSelector, keyword) {
  const table = document.querySelector(tableSelector);
  if (!table) return;
  const rows = table.querySelectorAll('tbody tr');
  const search = keyword.trim().toLowerCase();
  rows.forEach(row => {
    // Combine all cell text in the row
    const text = Array.from(row.cells).map(td => td.textContent.toLowerCase()).join(' ');
    // Show row if search is empty or found in text
    row.style.display = (!search || text.includes(search)) ? '' : 'none';
  });
};
</script>
{% endblock %}