{% extends "base.html" %}
{% set page_title = "Alarms" %}
{% block content %}
<div class="card border-0 shadow-soft mb-3">
  <div class="card-body d-flex flex-wrap gap-2 justify-content-between align-items-center">
    <div class="position-relative" style="min-width:280px;max-width:360px;width:100%;">
      <span class="position-absolute top-50 translate-middle-y ms-3 opacity-50">ðŸ”Ž</span>
      <input class="form-control ps-5" placeholder="Search alarmsâ€¦" oninput="App.filterTable('#tbl', this.value)">
    </div>
  </div>
</div>

<div class="card border-0 shadow-soft">
  <div class="table-responsive">
    <table id="tbl" class="table table-hover align-middle mb-0">
      <thead class="table-dark-subtle">
        <tr>
          <th style="width:110px">Time (UTC)</th>
          <th>Code</th>
          <th>Name</th>
          <th style="width:90px">Level</th>
          <th>Target</th>
          <th style="width:150px">Operator / Value</th>
        </tr>
      </thead>
      <tbody>
        {% for a in items %}
        <tr>
          <td class="text-muted small">{{ a.ts }}</td>
          <td class="fw-semibold">{{ a.code }}</td>
          <td>{{ a.name }}</td>
          <td>
            <span class="badge rounded-pill text-bg-danger"  {% if a.level=='High' %} {% endif %}>
              {{ a.level }}
            </span>
          </td>
          <td class="text-muted">{{ a.target }}</td>
          <td class="text-muted">{{ a.operator }} {{ a.threshold }}</td>
        </tr>
        {% else %}
          <tr><td colspan="6" class="text-center text-muted py-4">No alarms yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<script>
window.App = window.App || {};
App.filterTable = function(tableSelector, keyword) {
  const table = document.querySelector(tableSelector);
  if (!table) return;
  const rows = table.querySelectorAll('tbody tr');
  const search = keyword.trim().toLowerCase();
  rows.forEach(row => {
    // Combine all cell text in the row
    const text = Array.from(row.cells).map(td => td.textContent.toLowerCase()).join(' ');
    // Show row if search is empty or found in text
    row.style.display = (!search || text.includes(search)) ? '' : 'none';
  });
};
</script>
{% endblock %}
